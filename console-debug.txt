/**
 * ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìžˆëŠ” ë¡œê·¸ì¸ ë””ë²„ê¹… ì½”ë“œ
 * ì´ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ë¸Œë¼ìš°ì € ì½˜ì†”ì— ë¶™ì—¬ë„£ê³  ì‹¤í–‰í•˜ì„¸ìš”
 */

// 1. í™˜ê²½ ì²´í¬ ë° ìŠ¤í† ì–´ ìƒíƒœ í™•ì¸
console.log('ðŸ” LOGIN DEBUG START');
console.log('==================');

// ê¸°ë³¸ í™˜ê²½ ì²´í¬
console.log('1. Environment:');
console.log('- URL:', window.location.href);
console.log('- useSecurityStore available:', typeof window.useSecurityStore !== 'undefined');
console.log('- Login form present:', !!document.querySelector('form'));

// ìŠ¤í† ì–´ ìƒíƒœ ì²´í¬
if (window.useSecurityStore) {
  const state = window.useSecurityStore.getState();
  console.log('\n2. Store State:');
  console.log('- isAuthenticated:', state.isAuthenticated);
  console.log('- currentUser:', state.currentUser);
  console.log('- loginAttempts:', state.loginAttempts);
  console.log('- isLocked:', state.isLocked);
  console.log('- lockoutTime:', state.lockoutTime);
  
  // ê³„ì • ìž ê¸ˆ í•´ì œ
  if (state.isLocked) {
    console.log('\nðŸ”“ Unlocking account...');
    window.useSecurityStore.setState({
      isLocked: false,
      lockoutTime: null,
      loginAttempts: 0
    });
  }
  
  // ì§ì ‘ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
  console.log('\n3. Testing direct login...');
  window.useSecurityStore.getState().login('admin', 'admin123').then(result => {
    console.log('Login result:', result);
    const newState = window.useSecurityStore.getState();
    console.log('After login - isAuthenticated:', newState.isAuthenticated);
    console.log('After login - currentUser:', newState.currentUser);
    
    if (result) {
      console.log('âœ… LOGIN SUCCESS!');
      // íŽ˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì¸ì¦ ìƒíƒœ ë°˜ì˜
      setTimeout(() => {
        console.log('ðŸ”„ Refreshing page to reflect authentication...');
        window.location.reload();
      }, 1000);
    } else {
      console.log('âŒ LOGIN FAILED');
    }
  }).catch(error => {
    console.error('Login error:', error);
  });
} else {
  console.error('âŒ useSecurityStore not found');
  console.log('ðŸ’¡ Make sure you are on the login page and the app is loaded');
}

// 2. UI ë¡œê·¸ì¸ ì‹œë®¬ë ˆì´ì…˜ í•¨ìˆ˜
window.simulateLogin = function(username, password) {
  console.log(`ðŸ” Simulating login: ${username}`);
  
  const usernameInput = document.querySelector('input[type="text"]');
  const passwordInput = document.querySelector('input[type="password"]');
  const submitButton = document.querySelector('button[type="submit"]');
  
  if (!usernameInput || !passwordInput || !submitButton) {
    console.error('âŒ Form elements not found');
    return;
  }
  
  // í¼ ì±„ìš°ê¸°
  usernameInput.value = username;
  passwordInput.value = password;
  
  // ì´ë²¤íŠ¸ ë°œìƒ
  usernameInput.dispatchEvent(new Event('input', { bubbles: true }));
  passwordInput.dispatchEvent(new Event('input', { bubbles: true }));
  usernameInput.dispatchEvent(new Event('change', { bubbles: true }));
  passwordInput.dispatchEvent(new Event('change', { bubbles: true }));
  
  // ì œì¶œ
  setTimeout(() => {
    submitButton.click();
    console.log('âœ… Form submitted');
  }, 500);
};

// 3. ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
window.testAdmin = () => simulateLogin('admin', 'admin123');
window.testRadiologist = () => simulateLogin('radiologist', 'radio123');

console.log('\nðŸ’¡ Available commands:');
console.log('- testAdmin() - Test admin login');
console.log('- testRadiologist() - Test radiologist login');
console.log('- simulateLogin(username, password) - Custom login test');

console.log('\nðŸŽ¯ DEBUG COMPLETE!');